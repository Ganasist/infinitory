<% if params[:device_id] %>
  <h3>Booking sheet for <%= link_to @device.fullname, @device %></h3>
<% elsif params[:user_id] %>
  <h3>Your bookings</h3>
<% end %>

<table class="table table-striped">
  <thead>
    <tr>
      <% if params[:device_id] %>
        <th>User</th>
      <% end %>
      <th>Booked on</th>
      <% unless params[:device_id] %>
        <th>Device</th>
      <% end %>
      <th>Start time</th>
      <th>Duration</th>
      <th class="text-right" colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @bookings.each do |booking| %>

      <tr class="<%= if booking.finished? then 'text-danger' end %>">
        
        <% if params[:device_id] %>
          <td><%= booking.user.fullname %></td>
        <% end %>

        <td><%= booking.created_at.to_formatted_s(:short) %></td>

        <% unless params[:device_id] %> 
          <td>
            <%= fa_icon "gear", class: "fa-lg fa-spin", title: "Now running" if booking.in_progress? %>
            <%= link_to booking.device.fullname, booking.device %>
          </td>
        <% end %>

        <td>
          <%= fa_icon "gear", class: "fa-lg fa-spin", title: "Now running" if booking.in_progress? && params[:device_id] %>
          <%= booking.start_time.to_formatted_s(:short) %>
        </td>

        <td><%= booking.duration %></td>

        <% unless params[:device_id] %>
          <td><%= link_to 'Show', device_bookings_path(booking.device_id) %></td>
        <% else %>
          <td><%= link_to 'Show', booking_path(booking) %></td>
        <% end %>

        <% if !booking.finished? %>
          <td><%= link_to 'Edit', edit_booking_path(booking) %></td>
          <td><%= link_to 'Remove', booking, method: :delete %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<% if params[:device_id] %>
  <%= link_to 'New Booking', new_device_booking_path(params[:device_id]) %>
<% end %>

<hr>
<div id="calendar"></div>

