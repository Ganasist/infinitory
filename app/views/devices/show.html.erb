<%- model_class = Device -%>
<% cache @device do %>
  <% title fullname(@device) %>
  <div class="row">
    <div class="span6 devices">
    <% if @device.icon.present? %>
      <% if @device.icon_processing? %>
        <h4><%= fa_icon "spinner", title: "Edit", class: "fa-spin fa-lg fa-fw"  %> Processing image...</h4>
      <% else %>
        <span class="inline-block">
          <%= image_tag(@device.icon.url, class: 'img-rounded').html_safe %>
        </span><br>
      <% end %>
    <% end %>

      <h3><%= fullname(@device) %></h3>
      <h4><%= @device.category.titleize %></h4>
      <h4><%= link_to "The #{@device.gl.fullname} lab", @device.lab %></h4>

      <h4>
        <% if !@device.status? %>
          <span class="label label-danger">Offline</span><br><br>
        <% end %>
      </h4>

      <dl class="dl-vertical">
        <% unless @device.location.empty? %>
          <dt><strong>Location</strong></dt>
          <dd><%= best_in_place @device, :location %></dd><br>
        <% end %>

         <% if @device.uid? %>
          <dt>Unique ID</dt>
          <dd><%= best_in_place @device, :uid %></dd><br>
        <% end %>
        
        <% unless @device.users.empty? %>
          <dt><strong>Linked members(s)</strong></dt>
          <% @device.users.each do |user| %>
          <dd><%= link_to user.fullname, user %></dd>
          <% end %><br>
        <% end %>

        <% if @device.serial? %>
          <dt><strong>Serial #</strong></dt>
          <dd><%= best_in_place @device, :serial %></dd><br>
        <% end %>    

        <% if @device.price? %>
          <dt><strong>Price</strong></dt>
          <dd><%= best_in_place @device, :price, display_with: :number_to_currency, helper_options: { unit: @device.currency } %></dd><br>
        <% end %>

        <% unless @device.tag_list.empty? %>
          <dt><strong><%= model_class.human_attribute_name(:tags) %></strong></dt>
          <dd><%= raw @device.tag_list.map { |t| link_to t, tag_path(t) }.join(', ') %></dd><br>
        <% end %>

        <% if @device.product_url? %>
          <dt>Product website:</dt>
          <dd><%= link_to "#{@device.product_url}", url_with_protocol(@device.product_url), target: "_blank" %></dd><br>
        <% end %>

        <% if @device.purchasing_url? %>
          <dt>Purchasing website:</dt>
          <dd><%= link_to "#{@device.purchasing_url}", url_with_protocol(@device.purchasing_url), target: "_blank" %></dd><br>
        <% end %>

        <% if @device.pdf? %>
          <dt>Attachment</dt>
          <dd><%= link_to "#{ @device.pdf_file_name }",@device.pdf.url, target: "_blank"  %> - updated <%= time_ago_in_words(@device.pdf_updated_at) %> ago</dd><br>
        <% end %>
         <br>
      </dl>
      <div class="btn-group">
        <%= link_to ' Back', lab_devices_path(@device.lab), class: 'btn'  %>
        <%= link_to ' Edit', edit_device_path(@device), class: 'icon-edit btn btn-warning' %>
        <%= link_to ' Destroy', device_path(@device), method: 'delete', class: 'icon-trash btn btn-danger' %>
        <%= link_to ' Clone', clone_device_path(@device), class: 'icon-code-fork btn btn-info' %>
      </div>
      <hr>
    </div>
    <div class="span6">
      <!-- Nav panes -->
      <ul class="nav nav-pills nav-justified">
        <li class="active"><a href="#history" data-toggle="tab">History</a></li>
        <li class="disabled"><a href="#" data-toggle="tab">Messages</a></li>
      </ul><br>
      <!-- Tab panes -->
      <div class="tab-content">
        <div class="tab-pane fade in active" id="history">
        
        <div id="paginator-top">
          <%= paginate @activities, remote: true,
                                    theme: 'twitter-bootstrap', 
                                    pagination_class: 'pagination-small pagination-centered' %>
        </div>

        <div id="activities">
          <%= render 'activities' %>
        </div>
        
        <div id="paginator-bottom">
          <%= paginate @activities, remote: true,
                                    theme: 'twitter-bootstrap', 
                                    pagination_class: 'pagination-small pagination-centered' %>
        </div>
        
      </div>

      <div class="tab-pane fade" id="messages">MESSAGES</div>
      </div>
    
    </div>
  </div>
<% end %>