<h2 class="text-center"><%= current_user.fullname %>'s Profile</h2>
<br>

<%= simple_form_for(resource, :as => resource_name, url: registration_path(resource_name), 
                    html: { method: :put, :class => 'form-vertical' }) do |f| %>
<%= f.error_notification %>
<div class="form-inputs">
  <div class="row">
    <div class="span6 pull-right">
      <label>Picture</label><br>
       <% if @user.icon? %>
         <%= image_tag(@user.icon_url(:main)) %><br><br>
         Remove image
        <%= f.check_box :remove_icon %><br><br>
       <% end %>
       <%= f.input :remote_icon_url, placeholder: "Enter a URL", label: false %>
       <h4>or</h4>
       <%= f.input :icon, label: false %>  
       <%= f.hidden_field :icon_cache %>
    </div>
    <div class="span3">      
      <%= f.input :email, required: true, autofocus: true, input_html: { style: 'width: 350px'} %>
      <%= f.input :first_name, input_html: { style: 'width: 350px' } %>
      <%= f.input :last_name, input_html: { style: 'width: 350px'} %>
      
      <% if @user.role != "group_leader" %>
        <%= f.collection_select :description, User::DESCRIPTIONS, :to_s, :humanize, prompt: "Status",
                                  required: false %>
        <br><br>      
        <%= f.association :lab, label_method: :email, label: "Group leader email address",
                            value_method: :id, input_html: { style: 'width: 350px'} %>
      <% end %>

      <% if current_user.gl? %>
        <%= f.input :institute_name, placeholder: "Find or create your institute",
                      input_html: { style: 'width: 350px', data: { autocomplete_source: institutes_path }} %>        
        <span id="department_select">
          <%= f.input :department_id, 
                        collection: Institute.where(id: current_user.institute), as: :grouped_select,
                        group_method: :departments, include_blank: "None" %>
        </span>          
      <% end %>       
      <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
        <p>Currently waiting confirmation for: <%= resource.unconfirmed_email %></p>
      <% end %>

      <%= f.input :password, label: "New password (Optional)", :autocomplete => "off",
                  :required => false, input_html: { style: 'width: 350px'} %>

      <%= f.input :password_confirmation, label: "New password confirmation", :required => false,
                    wrapper_html: { style: 'display: none' },
                    input_html: { style: 'width: 330px' } %>

      <%= f.input :current_password, :hint => "Enter current password to confirm changes",
                  :required => true, input_html: { style: 'width: 350px'} %>
    </div>
  </div>
  <div class="form-actions">
    <%= f.button :submit, "Update" %>
  </div>
<% end %>

<h4><%= link_to "Cancel update", :back %></h4>
<h5><%= link_to "Delete my account",
                  registration_path(resource_name),
                  :data => { :confirm => "Are you sure you want to delete your account?" },
                  :method => :delete %></h5>
<br>
